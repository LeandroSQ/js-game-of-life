(()=>{var c=(o,t,e)=>new Promise((i,n)=>{var s=d=>{try{h(e.next(d))}catch(v){n(v)}},r=d=>{try{h(e.throw(d))}catch(v){n(v)}},h=d=>d.done?i(d.value):Promise.resolve(d.value).then(s,r);h((e=e.apply(o,t)).next())});window.addLoadEventListener=function(o){let t=!1,e=()=>{t||(t=!0,o())};window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e),document.addEventListener("load",e),window.addEventListener("ready",e),setTimeout(e,1e3)};window.addVisibilityChangeEventListener=function(o){let t=["webkit","moz","ms",""],e=!1,i=()=>{if(e)return;e=!0;let n=t.map(s=>s&&s.length>0?`${s}Hidden`:"hidden").map(s=>document[s]).reduce((s,r)=>s||r,!1);o(!n),setTimeout(()=>{e=!1},100)};for(let n of t)document.addEventListener(`${n}visibilitychange`,i);document.onvisibilitychange=i};CanvasRenderingContext2D.prototype.drawLine=function(o,t,e,i){this.beginPath(),this.moveTo(o,t),this.lineTo(e,i),this.stroke()};CanvasRenderingContext2D.prototype.drawCircle=function(o,t,e){this.beginPath(),this.arc(o,t,e,0,2*Math.PI)};HTMLCanvasElement.prototype.screenshot=function(o="download.png"){let t=document.createElement("a");t.download=o,t.href=this.toDataURL("image/png;base64"),t.style.visibility="hidden",t.style.display="none",document.body.appendChild(t),setTimeout(()=>{t.click(),document.body.removeChild(t)},100)};String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,o=>o[1].toUpperCase()).trim()};var a=class{static logColoredText(t,e,i,...n){console[t].call(console,`%c${t.toUpperCase()} %c[${e}]`,`font-weight: bold; color: ${i};`,"font-weight: bold; color: gray",...n)}static info(t,...e){this.logColoredText("info",t,"turquoise",...e)}static warn(t,...e){this.logColoredText("warn",t,"yellow",...e)}static error(t,...e){this.logColoredText("error",t,"red",...e)}static debug(t,...e){}};var p=class{static isColorLight(t){let e=`0x${t.trim().slice(1)}`;e.length<5&&(e=e.replace(/./g,"$&$&"));let i=parseInt(e,16),n=i>>16,s=i>>8&255,r=i&255;return Math.sqrt(.299*(n*n)+.587*(s*s)+.114*(r*r))>127.5}};var l=class{static setup(t){return c(this,null,function*(){l.main=t,l.loadVariables(),l.observeChanges()})}static loadVariables(){let t=["--background","--foreground","--container-background","--container-border","--container-shadow","--cell-alive","--cell-dead"];a.info("Theme",`Setting up theme, loading ${t.length} variables...`),console.groupCollapsed("Loading theme variables");let e=getComputedStyle(document.body);for(let i of t){let n=e.getPropertyValue(i),s=i.toString().toCamelCase();l[s]=n,console.log(`%c${s}`,`color: ${p.isColorLight(n)?"#212121":"#eee"}; background-color: ${n}`)}console.groupEnd()}static observeChanges(){let t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener("change",()=>{a.info("Theme",`Changed theme to ${t.matches?"dark":"light"}`),l.loadVariables()})}};var m=class{constructor(t=void 0){this.element=document.createElement("canvas");this.virtualWidth=0;this.virtualHeight=0;this.drawRatio=1;this.overrideRatio=void 0;t&&(this.element.id=t);let e=this.element.getContext("2d");if(!e)throw new Error("Could not get context of canvas");this.context=e,this.context.imageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1}get backingStoreRatio(){return this.overrideRatio||this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1}get devicePixelRation(){return this.overrideRatio||window.devicePixelRatio||1}getDrawRatio(t,e){return e/t}setSize(t,e){this.drawRatio=this.getDrawRatio(this.backingStoreRatio,this.devicePixelRation),this.backingStoreRatio!==this.devicePixelRation?(this.element.width=t*this.drawRatio,this.element.height=e*this.drawRatio,this.element.style.width=`${t}px`,this.element.style.minWidth=`${t}px`,this.element.style.height=`${e}px`,this.element.style.minHeight=`${e}px`):(this.element.width=t,this.element.height=e,this.element.style.width="",this.element.style.height=""),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=t,this.virtualHeight=e}clear(){this.context.clearRect(0,0,this.element.width,this.element.height)}drawTo(t,e,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.element,t,e),i.restore()}attachToElement(t){t.appendChild(this.element)}get width(){return this.virtualWidth||this.element.width}get height(){return this.virtualHeight||this.element.height}};var f=class{constructor(){this.rows=32;this.cols=32;this.cellWidth=0;this.cellHeight=0;this.cells=[];this.canvasBuffer=new m("grid-buffer");this.isDirty=!1}setupCells(){this.cells=[];for(let t=0;t<this.rows;t++){this.cells[t]=[];for(let e=0;e<this.cols;e++)this.cells[t][e]=0}}load(t){let e={x:Math.floor(this.cols/2),y:Math.floor(this.rows/2)};this.setupCells();let i=t[0].length,n=t.length;for(let s=0;s<n;s++)for(let r=0;r<i;r++)this.setCell(Math.floor(e.y+s-n/2),Math.floor(e.x+r-i/2),t[s][r])}random(){this.cells=[];for(let t=0;t<this.rows;t++){this.cells[t]=[];for(let e=0;e<this.cols;e++)this.cells[t][e]=Math.random()<=.25?1:0}}onLayout(t,e){let i=Math.min(t,e);this.cellHeight=i/this.rows,this.cellWidth=i/this.cols,this.canvasBuffer.setSize(t,e),this.isDirty=!0}getCell(t,e){return t<0||t>=this.rows||e<0||e>=this.cols?0:this.cells[t][e]}setCell(t,e,i){t<0||t>=this.rows||e<0||e>=this.cols||(this.cells[t][e]=i)}getNeighborCount(t,e){let i=0;return this.getCell(t-1,e)===1&&i++,this.getCell(t-1,e-1)===1&&i++,this.getCell(t,e-1)===1&&i++,this.getCell(t-1,e+1)===1&&i++,this.getCell(t,e+1)===1&&i++,this.getCell(t+1,e)===1&&i++,this.getCell(t+1,e-1)===1&&i++,this.getCell(t+1,e+1)===1&&i++,i}invalidate(){this.isDirty=!0}render(t){if(this.isDirty){this.isDirty=!1;let e=this.canvasBuffer.context;this.canvasBuffer.clear(),e.strokeStyle=l.containerBorder,e.lineWidth=1;for(let i=0;i<this.rows;i++)e.drawLine(0,i*this.cellHeight,e.canvas.width,i*this.cellHeight);for(let i=0;i<this.cols;i++)e.drawLine(i*this.cellWidth,0,i*this.cellWidth,e.canvas.height)}this.renderCells(t),this.canvasBuffer.drawTo(0,0,t)}renderCells(t){t.fillStyle=l.cellAlive;for(let e=0;e<this.rows;e++)for(let i=0;i<this.cols;i++)this.cells[e][i]===1&&t.fillRect(i*this.cellWidth,e*this.cellHeight,this.cellWidth,this.cellHeight)}update(){let t=[];for(let e=0;e<this.rows;e++){t[e]=[];for(let i=0;i<this.cols;i++){let n=this.getCell(e,i),s=this.getNeighborCount(e,i);n==1?s<2?t[e][i]=0:s===2||s===3?t[e][i]=1:s>3&&(t[e][i]=0):s===3&&(t[e][i]=1)}}this.cells=t}};var b=class{static load(){return c(this,null,function*(){let e=[12,20,40].map(i=>c(this,null,function*(){let n=`${i}pt ${b.fontFamily}`;document.fonts.check(n)||(yield document.fonts.load(n))}));yield Promise.all(e)})}},u=b;u.fontFamily="'Rubik', cursive";var g=class{static resolvePath(t){return(window.location.href.indexOf("http://localhost")?window.location.href:window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")))+"/assets/"+t}static parse(t){let e=t.split(`
`).map(r=>r.trim()),i=e.length,n=Math.max(...e.map(r=>r.length)),s=[];for(let r=0;r<i;r++){s[r]=[];for(let h=0;h<n;h++)e[r][h]==="X"?s[r][h]=1:s[r][h]=0}return console.groupCollapsed("Loading pattern"),console.table(s),a.debug("Pattern loader",`${i} rows and ${n} columns.`),console.groupEnd(),s}static load(t){return c(this,null,function*(){let i=yield(yield fetch(this.resolvePath(t))).text();return g.parse(i)})}};var w=class{constructor(){this.canvas=new m("canvas");this.ctx=this.canvas.context;this.targetFPS=15;this.targetFrameTime=1/this.targetFPS;this.frameTimer=0;this.lastFrameTime=performance.now();this.frameCounter=0;this.fpsTimer=0;this.fps=0;this.isPaused=!1;this.grid=new f;a.info("Game of life","Starting up..."),this.attachHooks(),l.setup(this)}attachHooks(){a.info("Checkers","Attaching hooks..."),window.addLoadEventListener(this.onLoad.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this))}onLoad(){return c(this,null,function*(){a.debug("Game of life","Window loaded");let t=document.getElementById("container");if(!t)throw new Error("Could not find container element");this.canvas.attachToElement(t),this.onLayout(),yield u.load(),yield this.loadPattern("glider"),this.requestNextFrame()})}onResize(){a.debug("Game of life","Window resized"),this.onLayout()}onVisibilityChange(t){a.debug("Game of life",`Window visibility changed to ${t}`?"visible":"hidden"),this.isPaused=!t,t&&this.requestNextFrame()}onLayout(){var n;a.debug("Game of life","Window layout changed");let t=(n=document.getElementById("container"))!=null?n:document.body,e=t.clientWidth,i=t.clientHeight;this.grid.onLayout(e,i),this.canvas.setSize(this.grid.cellWidth*this.grid.cols,this.grid.cellHeight*this.grid.rows)}requestNextFrame(){this.isPaused||(this.lastFrameTime=performance.now(),requestAnimationFrame(this.onFrame.bind(this)))}onFrame(t){if(this.isPaused)return;let e=(t-this.lastFrameTime)/1e3;for(this.frameTimer+=e,this.fpsTimer+=e;this.frameTimer>=this.targetFrameTime;)this.frameTimer-=this.targetFrameTime,e=this.targetFrameTime,this.frameCounter++,this.fpsTimer>=1&&(this.fpsTimer-=1,this.fps=this.frameCounter,this.frameCounter=0,a.debug("Game of life",`FPS: ${this.fps}`)),this.update();this.render(),this.requestNextFrame()}renderDebugOverlay(){}update(){this.grid.update()}render(){this.canvas.clear(),this.grid.render(this.ctx),this.renderDebugOverlay()}loadPattern(t){return c(this,null,function*(){let e=yield g.load(`pattern-${t}.txt`);this.grid.load(e)})}randomPattern(){return c(this,null,function*(){this.grid.random()})}};window._instance=new w;})();
